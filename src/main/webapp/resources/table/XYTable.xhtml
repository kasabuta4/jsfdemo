<?xml version='1.0' encoding='UTF-8' ?>

<ui:component
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:cc="http://xmlns.jcp.org/jsf/composite">

    <cc:interface name="XYTable">
        <cc:attribute name="model" required="true" />
    </cc:interface>

    <cc:implementation>
        <table class="#{cc.attrs.model.tableClass}">
            <ui:fragment id="caption" rendered="#{not empty cc.attrs.model.caption}">
                <caption><h:outputText value="#{cc.attrs.model.caption}" /></caption>
            </ui:fragment>
            <ui:fragment id="sequenceColumnColgroup" rendered="#{not empty cc.attrs.model.sequenceColumn}">
                <colgroup class="#{cc.attrs.model.sequenceColumn.columnClass}" />
            </ui:fragment>
            <ui:fragment id="xColumns" rendered="#{not empty cc.attrs.model.xColumns}">
                <colgroup>
                    <ui:repeat id="xColumn" var="xColumn" value="#{cc.attrs.model.xColumns}">
                        <col class="#{xColumn.columnClass}" />
                    </ui:repeat>
                </colgroup>
            </ui:fragment>
            <ui:repeat id="yColumn" var="yColumn" value="#{cc.attrs.model.yColumns}">
                <colgroup class="#{yColumn.columnClass}" span="#{yColumn.yList.size()}" />
            </ui:repeat>
            <thead>
                <tr>
                    <ui:fragment id="sequenceColumnThead" rendered="#{not empty cc.attrs.model.sequenceColumn}">
                        <th class="#{cc.attrs.model.sequenceColumn.headerCellClass}" rowspan="#{cc.attrs.model.maxYTitles + 1}">
                            <h:outputText value="#{cc.attrs.model.sequenceColumn.header}"/>
                        </th>
                    </ui:fragment>
                    <ui:repeat id="xColumns" var="xColumn" value="#{cc.attrs.model.xColumns}">
                        <th class="#{xColumn.headerCellClass}" rowspan="#{cc.attrs.model.maxYTitles + 1}">
                            <h:outputText value="#{xColumn.header}"/>
                        </th>
                    </ui:repeat>
                    <ui:repeat id="yColumns" var="yColumn" value="#{cc.attrs.model.yColumns}">
                        <ui:fragment id="yColumn" rendered="#{not empty yColumn.yList}">
                            <th class="#{yColumn.headerCellClass}" colspan="#{yColumn.yList.size()}">
                                <h:outputText value="#{yColumn.header}"/>
                            </th>
                        </ui:fragment>
                    </ui:repeat>
                </tr>
                <ui:repeat id="yTitleIndices" var="index" value="#{cc.attrs.model.yTitleIndices}">
                    <tr>
                        <ui:repeat id="yColumns" var="yColumn" value="#{cc.attrs.model.yColumns}">
                            <ui:repeat id="yList" var="y" value="#{yColumn.yList}">
                                <ui:fragment id="y" rendered="#{index le yColumn.yTitles.size()}">
                                    <th class="#{yColumn.yTitles[index].headerCellClass}" rowspan="#{yColumn.headerCellRowspan(index)}">
                                        <h:outputText value="#{yColumn.yTitles[index].property.apply(y)}"/>
                                    </th>
                                </ui:fragment>
                            </ui:repeat>
                        </ui:repeat>
                    </tr>
                </ui:repeat>
            </thead>
            <tbody>
                <ui:repeat id="xList" var="x" varStatus="status" value="#{cc.attrs.model.xList}">
                    <tr>
                        <ui:fragment id="sequenceColumnTBody" rendered="#{not empty cc.attrs.model.sequenceColumn}">
                            <ui:fragment id="sequenceColumnTh" rendered="#{cc.attrs.model.sequenceColumn.headerColumn}">
                                <th class="#{cc.attrs.model.sequenceColumn.bodyCellClass}">
                                    <h:outputText value="#{cc.attrs.model.sequenceColumn.property.apply(status.index + 1)}"/>
                                </th>
                            </ui:fragment>
                            <ui:fragment id="sequenceColumnTd" rendered="#{not cc.attrs.model.sequenceColumn.headerColumn}">
                                <td class="#{cc.attrs.model.sequenceColumn.bodyCellClass}">
                                    <h:outputText value="#{cc.attrs.model.sequenceColumn.property.apply(status.index + 1)}"/>
                                </td>
                            </ui:fragment>
                        </ui:fragment>
                        <ui:repeat id="xColumns" var="xColumn" value="#{cc.attrs.model.xColumns}">
                            <ui:fragment id="headerCell" rendered="#{xColumn.headerColumn}">
                                <th class="#{xColumn.bodyCellClass}">
                                    <h:outputText value="#{xColumn.property.apply(x)}"/>
                                </th>
                            </ui:fragment>
                            <ui:fragment id="dataCell" rendered="#{not xColumn.headerColumn}">
                                <td class="#{xColumn.bodyCellClass}">
                                    <h:outputText value="#{xColumn.property.apply(x)}"/>
                                </td>
                            </ui:fragment>
                        </ui:repeat>
                        <ui:repeat id="yColumns" var="yColumn" value="#{cc.attrs.model.yColumns}">
                            <ui:repeat id="yList" var="y" value="#{yColumn.yList}">
                                <td class="#{yColumn.bodyCellClass}">
                                    <h:outputText value="#{yColumn.property.apply(cc.attrs.model.data[x][y])}"/>
                                </td>
                            </ui:repeat>
                        </ui:repeat>
                    </tr>
                </ui:repeat>
            </tbody>
        </table>
    </cc:implementation>
</ui:component>
