<?xml version='1.0' encoding='UTF-8' ?>

<ui:component
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:cc="http://xmlns.jcp.org/jsf/composite">

    <cc:interface name="toolbar">
        <cc:attribute name="model" required="true" />
    </cc:interface>

    <cc:implementation>
        <table>
            <ui:fragment id="caption" rendered="#{not empty cc.attrs.model.title}">
                <caption><h:outputText value="#{cc.attrs.model.title}" /></caption>
            </ui:fragment>
            <ui:fragment id="rowKeyColgroups" rendered="#{not empty cc.attrs.model.rowKeyColumns}">
                <colgroup>
                    <ui:repeat id="rowKeyColumns" var="rowKeyColumn" value="#{cc.attrs.model.rowKeyColumns}">
                        <col class="#{rowKeyColumn.columnClass}" />
                    </ui:repeat>
                </colgroup>
            </ui:fragment>
            <ui:repeat id="colgroups" var="colgroup" value="#{cc.attrs.model.columnGroups}">
                <colgroup class="#{colgroup.colgroupClass}" span="#{colgroup.columnKeys.size()}" />
            </ui:repeat>
            <thead>
                <tr>
                    <ui:repeat id="rowKeyColumns" var="rowKeyColumn" value="#{cc.attrs.model.rowKeyColumns}">
                        <th rowspan="#{cc.attrs.model.columnTitleRowCount + 1}">
                            <h:outputText value="#{rowKeyColumn.title}"/>
                        </th>
                    </ui:repeat>
                    <ui:repeat id="colgroups" var="colGroup" value="#{cc.attrs.model.columnGroups}">
                        <ui:fragment id="colgroup" rendered="#{not empty colGroup.columnKeys}">
                            <th colspan="#{colGroup.columnKeys.size()}">
                                <h:outputText value="#{colGroup.title}"/>
                            </th>
                        </ui:fragment>
                    </ui:repeat>
                </tr>
                <ui:repeat id="columnTitleRows" var="rowIndex" value="#{cc.attrs.model.columnTitleRowIndices}">
                    <tr>
                        <ui:repeat id="colgroups" var="colGroup" value="#{cc.attrs.model.columnGroups}">
                            <ui:repeat id="columnKeys" var="columnKey" value="#{colGroup.columnKeys}">
                                <ui:fragment id="columnKey" rendered="#{rowIndex le colGroup.columnTitles.size()}">
                                    <th rowspan="#{colGroup.columnTitleRowspan(rowIndex)}">
                                        <h:outputText value="#{colGroup.columnTitles[rowIndex].apply(columnKey)}"/>
                                    </th>
                                </ui:fragment>
                            </ui:repeat>
                        </ui:repeat>
                    </tr>
                </ui:repeat>
            </thead>
            <tbody>
                <ui:repeat id="data" var="row" value="#{cc.attrs.model.rowKeys}">
                    <tr>
                        <ui:repeat id="rowKeyColumns" var="rowKeyColumn" value="#{cc.attrs.model.rowKeyColumns}">
                            <th>
                                <h:outputText value="#{rowKeyColumn.property.apply(row)}"/>
                            </th>
                        </ui:repeat>
                        <ui:repeat id="colgroups" var="colGroup" value="#{cc.attrs.model.columnGroups}">
                            <ui:repeat id="columns" var="column" value="#{colGroup.columnKeys}">
                                <td>
                                    <h:outputText value="#{colGroup.property.apply(cc.attrs.model.data[row][column])}"/>
                                </td>
                            </ui:repeat>
                        </ui:repeat>
                    </tr>
                </ui:repeat>
            </tbody>
        </table>
    </cc:implementation>
</ui:component>
